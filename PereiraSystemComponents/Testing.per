; TESTING -------------------------------------------------------
(defrule(true)=>(chat-local-to-self "> 9. Testing Loaded")(disable-self))

; GUARD
(defrule
    (unit-type-count monk > 0)
=>	
    (up-full-reset-search)	
    (up-find-local c: spearman-line c: 1)
	;(up-find-local c: all-units-class c: 240)	
	;(up-remove-objects search-local object-data-hitpoints < 50)
    (up-guard-unit monk c: spearman-line)
)


; REMOVE CHEAP UNITS
(defrule
	(current-age == imperial-age)
    (population-headroom == 0)
    (housing-headroom == 0)
    (wood-amount > 1000)(food-amount > 1000)(gold-amount > 1000)
    (game-time > 2100); 35 min
    (unit-type-count skirmisher-line > 0)
    (can-train hand-cannoneer)    
=>
	(delete-unit skirmisher-line)
    (train hand-cannoneer)
    (chat-local-to-self "'CHANGING' SKIRMISHERS FOR HAND CANNONEERS")
)

(defrule
	(current-age == imperial-age)
    (population-headroom == 0)
    (housing-headroom == 0)
    (wood-amount > 1300)(food-amount > 1300)(gold-amount > 1300)
    (game-time > 2100); 35 min
    (not(civ-selected gothic))(not(civ-selected japanese))    
    (unit-type-count spearman-line > 0)
    (can-train knight-line)    
=>
	(delete-unit spearman)(delete-unit pikeman)(delete-unit halberdier)
    (train knight-line)
    (chat-local-to-self "'CHANGING' SPEARMEN FOR KNIGHTS")
)

(defrule
	(not	(player-in-game any-ally))
	(unit-type-count trade-cart > 0)
=>
	(delete-unit trade-cart)
)

; USER PATCH WALL
(defconst gl-point-x 480) ; limit constant 510
(defconst gl-point-y 481)
(defconst gl-other-x 482)
(defconst gl-other-y 483)
(defconst gl-wall-start-x 484)
(defconst gl-wall-start-y 485)
(defconst gl-wall-end-x 486)
(defconst gl-wall-end-y 487) 
(defconst gl-wall-other-end-x 488) 
(defconst gl-wall-other-end-y 489)
(defconst gl-center-x 490)
(defconst gl-center-y 491)

(defrule
    (true) ;just in case
=>
    (set-goal gl-point-x 0)
    (set-goal gl-point-y 0)
    (set-goal gl-other-x 0)    
    (set-goal gl-other-y 0)
    (set-goal gl-wall-start-x 0)
    (set-goal gl-wall-start-y 0)
    (set-goal gl-wall-end-x 0)
    (set-goal gl-wall-end-y 0)
    (set-goal gl-wall-other-end-x 0) 
    (set-goal gl-wall-other-end-y 0)      
    (disable-self)  
)

(defrule
    (true)
=>
    (up-get-point position-self gl-point-x)    ; the next constant y gets auto filled 
    (up-get-point position-center gl-center-x)
    (disable-self)   
)

(defrule
    (true)
=>  
    (up-chat-data-to-self "CENTER X = %d" g: gl-center-x)
    (up-chat-data-to-self "CENTER Y = %d" g: gl-center-y)
    (disable-self) 
)

; TIMER 30 POSITION TO SELF
(defrule(true)=>(enable-timer 30 2)(disable-self)) 
(defrule
    (timer-triggered 30)
=>  
    (disable-timer 30)
    (enable-timer 30 60)
    (up-chat-data-to-self "MY POS X = %d" g: gl-point-x)
    (up-chat-data-to-self "MY POS Y = %d" g: gl-point-y)
)

; TIMER 31 POSITION TO ALLIES
(defrule(true)=>(enable-timer 31 6)(disable-self))

(defrule
    (timer-triggered 31)
=>  
    (disable-timer 31)
    (enable-timer 31 60)
    (up-chat-data-to-player any-ally "MY POS X = %d" g: gl-point-x)
    (up-chat-data-to-player any-ally "MY POS Y = %d" g: gl-point-y) 
)

(defrule
    (up-compare-goal gl-point-x > gl-center-x)
=>
    (chat-to-all "IM AT HIGH X ZONE")(disable-self)  
)

(defrule
    (up-compare-goal gl-point-x < gl-center-x) 
=>
    (chat-to-all "IM AT LOW X ZONE")(disable-self)  
)

(defrule
    (up-compare-goal gl-point-y > gl-center-y)
=>
    (chat-to-all "IM AT HIGH Y ZONE")(disable-self)  
)

(defrule
    (up-compare-goal gl-point-y < gl-center-y) 
=>
    (chat-to-all "IM AT LOW Y ZONE")(disable-self)  
)

(defrule
    (up-compare-goal gl-point-x < gl-point-y) 
=>
    (chat-to-all "MY X IS LOWER THAN Y")(disable-self)  
)

(defrule
    (up-compare-goal gl-point-x > gl-point-y) 
=>
    (chat-to-all "MY Y IS LOWER THAN X")(disable-self)  
)

; ----
(defrule
    (up-compare-goal gl-point-x > gl-center-x)
    (up-compare-goal gl-point-y > gl-center-y)
=>
    ;(chat-to-all "IM AT HIGH X ZONE AND HIGH Y")
    (set-goal gl-wall-start-x 90)
    (set-goal gl-wall-start-y 120)
    (set-goal gl-wall-end-x 90)
    (set-goal gl-wall-end-y 40)
    (set-goal gl-wall-other-end-x 120)
    ;(set-goal gl-wall-other-end-y 90)    
    (disable-self)    
)

(defrule
    (up-compare-goal gl-point-x < gl-center-x)
    (up-compare-goal gl-point-y > gl-center-y) 
=>
    ;(chat-to-all "IM AT LOW X ZONE AND HIGH Y ")
    (set-goal gl-wall-start-x 30)
    (set-goal gl-wall-start-y 90)
    (set-goal gl-wall-end-x 30)
    (set-goal gl-wall-end-y 60)
    (disable-self)  
)

(defrule
    (up-compare-goal gl-point-x > gl-center-x)
    (up-compare-goal gl-point-y < gl-center-y)
=>
    ;(chat-to-all "IM AT HIGH X ZONE AND LOW Y")
    (set-goal gl-wall-start-x 90)
    (set-goal gl-wall-start-y 30)
    (set-goal gl-wall-end-x 90)
    (set-goal gl-wall-end-y 30)    
    (disable-self)  
)

(defrule
    (up-compare-goal gl-point-x < gl-center-x)
    (up-compare-goal gl-point-y < gl-center-y)
=>
    ;(chat-to-all "IM AT LOW X ZONE AND LOW Y")
    (set-goal gl-wall-start-x 30)
    (set-goal gl-wall-start-y 90)
    (set-goal gl-wall-end-x 30)
    (set-goal gl-wall-end-y 90)    
    (disable-self)
)


(defrule
    (true)
    ;(up-can-build-line 0 gl-wall-start-x c: palisade-wall)
=>
    (up-build-line gl-wall-start-x gl-wall-end-x c: palisade-wall)
    (chat-local-to-self "BUILDING THE WALL SECTION A !")
    (do-nothing)
)

(defrule
    (true)
    ;(up-can-build-line 0 gl-wall-start-x c: palisade-wall)
=>
    ;(up-build-line gl-wall-end-x gl-wall-other-end-x c: palisade-wall)
    ;(chat-local-to-self "BUILDING THE WALL SECTION B !")
    (do-nothing)
)

(defrule
    (building-type-count-total 793 < 3)
    ;(up-can-build-line gl-point-y gl-other-y c: 793)
=>
    ;(up-build-line gl-point-y gl-other-y c: palisade-gate)
    ;(up-build-line gl-point-y gl-other-y c: 798)    ;diagonal left-right
    ;(up-build-line gl-point-y gl-other-y c: 801)    ;diagonal north-south   
    ;(up-build-line gl-point-y gl-other-y c: 789)    ;along y axis
    ;(up-build-line gl-point-y gl-other-y c: 793)    ;along x axis
    ;(chat-to-player my-player-number "BUILDING THE GATES TO THE WALL FRONT")
    (do-nothing)
)